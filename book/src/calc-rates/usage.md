# Usage

calc-rates currently consists of two commands:
- `new`: Creates an example configuration file. By default the file is created as `calc-rates.ron` in the current directory.
- `calc`: calculates and outputs rates given a configuration file. By default this is `calc-rates.ron` in the current directory.

## Configuration

The configuration file, typically named `calc-rates.ron` determines how calc-rates will take inputs, calculate rates and output those rates.
An example of a configuration file for calc-rates is shown below,

Filename: calc-rates.ron
```ron
(
    result_sets: [
        (
            name: "natural_cubic_spline",
            source: "./results/ics.s2P.s2S",
            grid: [NaturalCubic("..")],
            energy_units: Auto,
            cs_units: Auto,
        ),
        (
            name: "monotone_cubic_spline",
            source: "./results/ics.s2P.s2S",
            grid: [MonotoneCubic("..")],
            energy_units: Auto,
            cs_units: Auto,
        ),
    ],
    temperatures: [
        Sequence(start: 1.0, end: 10.0, n: 10)
    ],
    temperature_units: ElectronVolt,
    output_folder: "./calc-rates-out",
    output_integrands: false,
    collision_rate_units: Atomic,
)
```

> [!NOTE]
> It is recommended to create this file through `calc-rates new` or `calc-rates new --path <CUSTOM-FILE-PATH>` then edit to fit your project.

Which exists in the following folder structure,

```
my_project/
├── results/
|   └── ics.s2P.s2S
└── calc-rates.ron
```

and after calling `calc-rates calc` to output the calculated rates,

```
my_project/
├── calc-rates-out/
|   ├── monotone_cubic_spline
|   └── natural_cubic_spline
├── results/
|   └── ics.s2P.s2S
└── calc-rates.ron
```

### Utilising code documentation

Documentation generated by `cargo docs` for `calc-rates` can be found [here](https://noonicknames.github.io/ccc-tools/doc/calc_rates/) and can be useful for better understanding the configuration file.

The .ron file format (Rusty Object Notation), see [here](https://github.com/ron-rs/ron?tab=readme-ov-file), was chosen to have as little friction between how the configuration file is written and its representation in code.
Consequently, this means the code documentation can be incredibly useful for understanding the configuration file.
For instance, [ConfigSerde](https://noonicknames.github.io/ccc-tools/doc/calc_rates/config/struct.ConfigSerde.html) is directly serialised/deserialised from calc-rates.ron,

```rs
pub struct ConfigSerde {
    pub result_sets: Vec<ResultSetSerde>,
    pub temperatures: Vec<TemperatureGridPoints>,
    pub temperature_units: TemperatureUnits,
    pub output_integrands: bool,
    pub energy_units: Option<EnergyUnitsOrAuto>,
    pub cs_units: Option<CsUnitsOrAuto>,
    pub output_folder: String,
    pub collision_rate_units: CollisionRateUnits,
}
```

Noticing how this matches one-to-one with our calc-rates.ron file, we can look at documentation for specific fields such as `temperatures` or `temperature_units` to understand their usage.
By looking at the underlying type behind `temperature_units`, [TemperatureUnits](https://noonicknames.github.io/ccc-tools/doc/calc_rates/config/enum.TemperatureUnits.html), we see there are three possible variants,

```rs
pub enum TemperatureUnits {
    Kelvin,
    ElectronVolt,
    Hartree,
}
```

Therefore, it is expected that the following changes below lead to valid `calc-rates.ron` files,

Filename: calc-rates.ron
```ron
(
    // ...
    temperature_units: Kelvin,
)
```

Filename: calc-rates.ron
```ron
(
    // ...
    temperature_units: Hartree,
)
```

> [!TIP]
> Misspelling a configuration field, e.g. `temperature_units: IForgot`, then running `calc-rates calc` will often give a helpful error message.